---
title: "Vectorization Slides"
author: Adam Kaplan
date: "March 30, 2022"
output: 
  beamer_presentation:
    theme: "CambridgeUS"
    colortheme: "beaver"
    incremental: true
---

```{r settings, echo=FALSE, message=FALSE}
here::i_am("vectorization-slides.Rmd")
library(knitr)
library(tidyverse)
knit_engines$set("rcpp")
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

# Vectorization: `apply` and `purrr`

## Vectorization: `apply` and `purrr`

- `apply`, `lapply`, `sapply`, ... come built-in with `R` and allow you to apply _any_ function in a vectorized way to a matrix/dataframe, list, or vector.
- `purrr`'s `map`, `map_dbl`, `map_dfc`, ... are the `tidyverse` equivalents and extensions to the `apply()` family.

---

```{r vectorization-comparison1, eval = FALSE}
library(tidyverse)
d <- list(
  data.frame(quant = c("danny", "insong", "teppei")),
  data.frame(schools = c("MIT", "Harvard"))
)
# We want a list as an output
lapply(d, function(x) nrow(x))

# default map returns a list
map(d, function(x) nrow(x))

# The tidy version
d %>% map(~ nrow(.x))
```

---

```{r vectorization-comparison2, eval = FALSE}
library(tidyverse)
v <- 1:10

# We want a list as an output
sapply(v, function(x) x * x)

# The tidy version
v %>% map_dbl(~ .x * .x)
```

## Vectorization using `purrr`

- `map_*` return different object type and will fail if it is not appropriate.
- Makes the code more predictable, and thus easier to debug.
- Of particular interest are `map_dfr` and `map_dfc`, which run a function on the input and then row/column bind the outputs together.
- Inspired popular parallelization package `furrr` which we will introduce you to shortly.